version: 2

macros:
  - name: hist
    description: "Creates a compromised history of changes to the specified entity keys from a append only table containing daily full snapshot."
    usage: >-
      {{
        vdl_macros.hist(
          from=source("oebs", "hierarki"),
          entity_key=["hierarchy_code", "flex_value_id"],
          check_cols=[
              "flex_value",
              "description",
              "flex_value_id_parent",
              "flex_value_parent",
              "description_parent",
              "flex_value_set_name",
          ],
          loaded_at="_loaded_at",
        )
      }}
    arguments:
      - name: from
        type: relation
        description: The append only table containing daily full snapshot you want to make history for.
      - name: entity_key
        type: column
        description: "The entity key(s) column in the <from> table that uniquely identify a record to track changes to."
      - name: check_cols
        type: list[column]
        description: "The columns in the <from> table to check for changes."
      - name: loaded_at
        type: column
        description: "The column containing timestamp of when the row was loaded in the <from> table."
